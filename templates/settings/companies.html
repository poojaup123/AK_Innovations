{% extends "base.html" %}

{% block title %}Company Management{% endblock %}

{% block extra_css %}
<style>
.company-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease-in-out;
    margin-bottom: 1.5rem;
}

.company-card:hover {
    transform: translateY(-3px);
}

.company-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px 15px 0 0;
    padding: 1.5rem;
}

.default-badge {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
}

.inactive-badge {
    background: #dc3545;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-building"></i> Company Management</h2>
        <div class="btn-group">
            <a href="{{ url_for('settings_advanced.settings_dashboard') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to Settings
            </a>
            <a href="{{ url_for('settings_advanced.add_company') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add Company
            </a>
        </div>
    </div>

    {% if companies %}
    <div class="row">
        {% for company in companies %}
        <div class="col-md-6 col-lg-4">
            <div class="card company-card">
                <div class="company-header">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h5 class="mb-1">{{ company.name }}</h5>
                            <small class="opacity-75">{{ company.code }}</small>
                        </div>
                        <div>
                            {% if company.is_default %}
                                <span class="default-badge">Default</span>
                            {% endif %}
                            {% if not company.is_active %}
                                <span class="inactive-badge">Inactive</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="company-details">
                        {% if company.address_line1 %}
                        <p class="mb-2">
                            <i class="fas fa-map-marker-alt text-muted me-2"></i>
                            {{ company.address_line1 }}<br>
                            {% if company.city %}{{ company.city }}, {% endif %}
                            {% if company.state %}{{ company.state }}{% endif %}
                            {% if company.pin_code %} - {{ company.pin_code }}{% endif %}
                        </p>
                        {% endif %}
                        
                        {% if company.phone %}
                        <p class="mb-2">
                            <i class="fas fa-phone text-muted me-2"></i>
                            {{ company.phone }}
                        </p>
                        {% endif %}
                        
                        {% if company.email %}
                        <p class="mb-2">
                            <i class="fas fa-envelope text-muted me-2"></i>
                            {{ company.email }}
                        </p>
                        {% endif %}
                        
                        {% if company.gst_number %}
                        <p class="mb-2">
                            <i class="fas fa-file-invoice text-muted me-2"></i>
                            GST: {{ company.gst_number }}
                        </p>
                        {% endif %}
                    </div>
                    
                    <div class="company-actions mt-3">
                        <div class="btn-group w-100">
                            <a href="{{ url_for('settings_advanced.edit_company', company_id=company.id) }}" 
                               class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <a href="{{ url_for('settings_advanced.company_users', company_id=company.id) }}" 
                               class="btn btn-outline-success btn-sm">
                                <i class="fas fa-users"></i> Users
                            </a>
                            {% if not company.is_default %}
                            <button class="btn btn-outline-warning btn-sm" 
                                    onclick="setDefaultCompany({{ company.id }}, '{{ company.name }}')">
                                <i class="fas fa-star"></i> Set Default
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="fas fa-building fa-4x text-muted mb-3"></i>
        <h4>No Companies Found</h4>
        <p class="text-muted">Add your first company to get started with multi-company management.</p>
        <a href="{{ url_for('settings_advanced.add_company') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Company
        </a>
    </div>
    {% endif %}
</div>

<script>
function setDefaultCompany(companyId, companyName) {
    if (confirm(`Set "${companyName}" as the default company?`)) {
        fetch(`/settings/companies/${companyId}/set-default`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            alert('Error setting default company');
        });
    }
}
</script>
{% endblock %}