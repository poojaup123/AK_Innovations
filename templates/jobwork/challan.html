<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Work Challan - {{ job.job_number }}</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 15px;
            color: #333;
            background: white;
            font-size: 12px;
        }
        .challan-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border: 1px solid #ddd;
        }
        .header {
            background: linear-gradient(135deg, #4a90e2, #2c5aa0);
            color: white;
            padding: 15px;
            text-align: right;
            font-size: 11px;
        }
        .header-info {
            line-height: 1.4;
        }
        .section-header {
            background: #4a90e2;
            color: white;
            padding: 8px 15px;
            font-weight: bold;
            font-size: 13px;
            display: flex;
            align-items: center;
        }
        .section-header i {
            margin-right: 8px;
        }
        .section-content {
            padding: 15px;
        }
        .company-row {
            display: flex;
            gap: 30px;
        }
        .company-col {
            flex: 1;
        }
        .company-col h4 {
            font-size: 13px;
            font-weight: bold;
            margin: 0 0 8px 0;
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 11px;
        }
        table th {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-weight: bold;
            color: #333;
        }
        table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .declarations-box {
            background: #fff5f5;
            border-left: 4px solid #dc3545;
            padding: 10px 15px;
            margin: 10px 0;
        }
        .declarations-box ul {
            margin: 0;
            padding-left: 20px;
            font-size: 11px;
        }
        .signature-row {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .signature-box {
            flex: 1;
            border: 1px solid #ddd;
            padding: 15px;
            text-align: center;
            min-height: 100px;
        }
        .signature-box h4 {
            font-size: 12px;
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .signature-box h4 i {
            margin-right: 5px;
        }
        .signature-line {
            border-bottom: 1px solid #ddd;
            margin: 40px 0 10px 0;
            height: 1px;
        }
        .badge {
            display: inline-block;
            padding: 2px 6px;
            background: #6c757d;
            color: white;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }
        .badge.outsourced { background: #dc3545; }
        .badge.in-house { background: #28a745; }
        @media print {
            body { margin: 0; padding: 5px; }
            .challan-container { border: none; }
        }
    </style>
</head>
<body>
    <div class="challan-container">
        <!-- Header -->
        <div class="header">
            <div class="header-info">
                <strong>Date:</strong> {{ job.created_at.strftime('%d-%b-%Y') }}<br>
                <strong>Document Type:</strong> Job Work Challan<br>
                <strong>Challan No:</strong> JW-{{ job.job_number.replace('JOB-', '') }}<br>
                <strong>Job Work Type:</strong> {{ job.work_type|title }}{% if processes|length > 1 %} (Multi-Process){% endif %}<br>
                <strong>Reference Job No:</strong> {{ job.job_number }}
            </div>
        </div>

        <!-- Company Details -->
        <div class="section-header">
            <i>💼</i> Company Details
        </div>
        <div class="section-content">
            <div class="company-row">
                <div class="company-col">
                    <h4>Sender (Factory Details)</h4>
                    <strong>{{ company_settings.company_name if company_settings else 'AK Innovations Pvt Ltd' }}</strong><br>
                    {% if company_settings and company_settings.address %}
                        {{ company_settings.address }}<br>
                    {% else %}
                        Plot No. XX, XYZ Industrial Estate,<br>
                        Delhi - 11000X, India<br>
                    {% endif %}
                    {% if company_settings and company_settings.phone %}
                        📞 {{ company_settings.phone }} |
                    {% else %}
                        📞 +91-9876543210 |
                    {% endif %}
                    {% if company_settings and company_settings.email %}
                        📧 {{ company_settings.email }}
                    {% else %}
                        📧 deepak.gupta087@gmail.com
                    {% endif %}
                </div>
                <div class="company-col">
                    <h4>Recipient (Vendor/Contractor Details)</h4>
                    <strong>{{ job.customer_name or 'Multi-Process Job' }}</strong><br>
                    Address: (To be filled)<br>
                    📞 (Contact Number)
                </div>
            </div>
        </div>

        <!-- Material Dispatched -->
        <div class="section-header">
            <i>📦</i> Material Dispatched for Job Work
        </div>
        <div class="section-content">
            <table>
                <thead>
                    <tr>
                        <th>S.No</th>
                        <th>Item Name</th>
                        <th>Raw Material Code</th>
                        <th>Qty Sent</th>
                        <th>Unit</th>
                        <th>UOM</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>{{ job.item.name }}</td>
                        <td>{{ job.item.code or 'ITEM-' + ('%04d'|format(job.item.id)) }}</td>
                        <td>{{ job.quantity_sent }}</td>
                        <td>{{ job.item.unit_of_measure }}</td>
                        <td>Sheet(s)</td>
                        <td>For {{ job.process|title if job.process else 'Cutting' }}</td>
                    </tr>
                    {% if processes %}
                        {% for process in processes %}
                            {% if process.output_item_id %}
                            <tr>
                                <td>{{ loop.index + 1 }}</td>
                                <td>{{ process.output_item.name }}</td>
                                <td>{{ process.output_item.code or 'ITEM-' + ('%04d'|format(process.output_item.id)) }}</td>
                                <td>-</td>
                                <td>{{ process.output_item.unit_of_measure }}</td>
                                <td>Output</td>
                                <td>Will be generated</td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Job Work Process Flow -->
        {% if processes and processes|length > 0 %}
        <div class="section-header">
            <i>🔄</i> Job Work Process Flow{% if processes|length > 1 %} (Sequential){% endif %}
        </div>
        <div class="section-content">
            <table>
                <thead>
                    <tr>
                        <th>Process Seq</th>
                        <th>Process Name</th>
                        <th>From Item</th>
                        <th>To Item</th>
                        <th>Qty</th>
                        <th>Work Type</th>
                        <th>Expected Return Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for process in processes %}
                    <tr>
                        <td>{{ process.sequence_number }}</td>
                        <td>{{ process.process_name }}</td>
                        <td>
                            {% if loop.first %}
                                {{ job.item.name }} ({{ job.quantity_sent }} {{ job.item.unit_of_measure }})
                            {% else %}
                                {% set prev_process = processes[loop.index0 - 1] %}
                                {% if prev_process.output_item_id %}
                                    {{ prev_process.output_item.name }}
                                {% else %}
                                    {{ job.item.name }}
                                {% endif %}
                            {% endif %}
                        </td>
                        <td>
                            {% if process.output_item_id %}
                                {{ process.output_item.name }}
                            {% else %}
                                Same as input
                            {% endif %}
                        </td>
                        <td>{{ process.output_quantity or job.quantity_sent }}</td>
                        <td><span class="badge {{ 'outsourced' if process.work_type == 'outsourced' else 'in-house' }}">{{ process.work_type|title }}</span></td>
                        <td>{{ (job.expected_return.strftime('%d-%b-%Y') if job.expected_return else '30-Jul-2025') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Scrap Acknowledgment -->
        {% if processes %}
        <div class="section-header">
            <i>⚖️</i> Scrap Acknowledgment
        </div>
        <div class="section-content">
            <table>
                <thead>
                    <tr>
                        <th>Process</th>
                        <th>Expected Scrap</th>
                        <th>Unit</th>
                    </tr>
                </thead>
                <tbody>
                    {% for process in processes %}
                    <tr>
                        <td>{{ process.process_name }}</td>
                        <td>{{ process.quantity_scrap or '0.0' }}</td>
                        <td>kg</td>
                    </tr>
                    {% endfor %}
                    {% if not processes %}
                    <tr>
                        <td>{{ job.process or 'General Job Work' }}</td>
                        <td>{{ job.expected_scrap or '0.0' }}</td>
                        <td>kg</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Supporting Details -->
        <div class="section-header">
            <i>📑</i> Supporting Details
        </div>
        <div class="section-content">
            <strong>Challan Created By:</strong> System Auto-Generated<br>
            <strong>Created Date:</strong> {{ job.created_at.strftime('%d-%b-%Y %I:%M %p') }}<br>
            {% if job.notes %}
            <strong>Special Instructions:</strong> {{ job.notes }}<br>
            {% else %}
            <strong>Special Instructions:</strong> [2025-07-28 00:59] Completed via GRN GRN-2025-0005 - All expected output materials received<br>
            {% endif %}
            <strong>Delivery Mode:</strong> Road Transport
        </div>

        <!-- Declarations -->
        <div class="section-header">
            <i>🔐</i> Declarations
        </div>
        <div class="section-content">
            <div class="declarations-box">
                <ul>
                    <li>Goods are sent for job work only. No sale is intended.</li>
                    <li>Goods will be returned within 180 days.</li>
                    <li>The recipient is liable for any damage/loss during transit or job work.</li>
                    <li>This challan is subject to terms and conditions of the job work agreement.</li>
                </ul>
            </div>
        </div>

        <!-- Signatures -->
        <div class="signature-row">
            <div class="signature-box">
                <h4><i>✍️</i> Authorised Signatory (Sender)</h4>
                <div class="signature-line"></div>
                <div style="font-size: 11px; text-align: left;">
                    <strong>Name:</strong> _________________________<br>
                    <strong>Date:</strong> {{ job.created_at.strftime('%d-%b-%Y') }}<br>
                    <strong>Designation:</strong> ____________________
                </div>
            </div>
            <div class="signature-box">
                <h4><i>🌸</i> Acknowledgement by Vendor</h4>
                <p style="font-size: 10px; margin-bottom: 15px;">Received the above material in good condition for job work.</p>
                <div class="signature-line"></div>
                <div style="font-size: 11px; text-align: left;">
                    <strong>Name:</strong> _________________________<br>
                    <strong>Date:</strong> _________________________<br>
                    <strong>Stamp & Signature:</strong> _______________
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto-print when page loads
        window.addEventListener('load', function() {
            setTimeout(function() {
                window.print();
            }, 500);
        });
    </script>
</body>
</html>