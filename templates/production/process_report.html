{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1><i class="fas fa-chart-line text-primary"></i> Process Integration Report</h1>
            <p class="text-muted">Intelligent workflow integration between Manufacturing Processes and BOM</p>
        </div>
        <div>
            <a href="{{ url_for('production.edit_bom', id=bom.id) }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to BOM
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5><i class="fas fa-cogs"></i> BOM: {{ bom.bom_code }}</h5>
                    <small>Product: {{ bom.product.name if bom.product else 'Unknown' }}</small>
                </div>
                <div class="card-body">
                    <pre class="bg-light p-3 rounded">{{ report }}</pre>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- Integration Status Card -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h6><i class="fas fa-brain"></i> Smart Integration Status</h6>
                </div>
                <div class="card-body">
                    {% if bom.processes %}
                    <div class="row mb-3">
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h4 text-success">{{ bom.processes|length }}</div>
                                <small class="text-muted">Process Steps</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h4 text-info">{{ bom.manufacturing_complexity }}</div>
                                <small class="text-muted">Complexity</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Labor Cost Integration:</strong>
                        <div class="d-flex justify-content-between">
                            <span>Process-Driven:</span>
                            <span class="text-success">₹{{ "%.2f"|format(bom.total_process_cost_per_unit) }}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Manual Entry:</span>
                            <span class="text-muted">₹{{ "%.2f"|format(bom.labor_cost_per_unit or 0) }}</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <strong>Active Value:</strong>
                            <strong class="text-primary">₹{{ "%.2f"|format(bom.calculated_labor_cost_per_unit) }}</strong>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Scrap Management:</strong>
                        <div class="d-flex justify-content-between">
                            <span>Process-Driven:</span>
                            <span class="text-warning">{{ "%.2f"|format(bom.calculated_scrap_percent) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Manual Entry:</span>
                            <span class="text-muted">{{ "%.2f"|format(bom.estimated_scrap_percent or 0) }}%</span>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <form method="POST" action="{{ url_for('production.sync_bom_from_processes', id=bom.id) }}">
                            <button type="submit" class="btn btn-success btn-sm">
                                <i class="fas fa-sync"></i> Sync from Processes
                            </button>
                        </form>
                    </div>
                    
                    {% else %}
                    <div class="text-center text-muted">
                        <i class="fas fa-exclamation-circle fa-2x mb-2"></i>
                        <p>No manufacturing processes defined</p>
                        <a href="{{ url_for('production.add_bom_process', bom_id=bom.id) }}" class="btn btn-primary btn-sm">
                            Add Process
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Integration Benefits Card -->
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h6><i class="fas fa-lightbulb"></i> Integration Benefits</h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success"></i> Automatic cost calculation</li>
                        <li><i class="fas fa-check text-success"></i> Real-time scrap tracking</li>
                        <li><i class="fas fa-check text-success"></i> Process-driven accuracy</li>
                        <li><i class="fas fa-check text-success"></i> Reduced manual errors</li>
                        <li><i class="fas fa-check text-success"></i> Manufacturing intelligence</li>
                    </ul>
                    
                    <div class="alert alert-info mt-3">
                        <small>
                            <i class="fas fa-info-circle"></i> Process workflows automatically populate Labor Costs and Scrap Management based on manufacturing complexity and timing.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-refresh report data every 30 seconds
setInterval(function() {
    // Optional: Add AJAX refresh for real-time data
}, 30000);
</script>
{% endblock %}