{% extends "base.html" %}

{% block title %}General Accounting Settings - Factory Management System{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <h1><i class="fas fa-cog"></i> General Accounting Settings</h1>
            <p class="text-muted">Configure automation, default accounts, and system preferences</p>
        </div>
        <div class="col-auto">
            <a href="{{ url_for('accounting_settings.dashboard') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Settings
            </a>
        </div>
    </div>

    <form method="POST">
        {{ form.hidden_tag() }}
        
        <div class="row">
            <!-- Automation Settings -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-robot"></i> Automation Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.auto_jv_posting(class="form-check-input") }}
                                {{ form.auto_jv_posting.label(class="form-check-label") }}
                            </div>
                            <small class="text-muted">Automatically post journal vouchers when created</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.auto_grn_voucher(class="form-check-input") }}
                                {{ form.auto_grn_voucher.label(class="form-check-label") }}
                            </div>
                            <small class="text-muted">Auto-create vouchers on GRN receipt</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.auto_sales_voucher(class="form-check-input") }}
                                {{ form.auto_sales_voucher.label(class="form-check-label") }}
                            </div>
                            <small class="text-muted">Auto-create vouchers on sales invoice</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.auto_production_voucher(class="form-check-input") }}
                                {{ form.auto_production_voucher.label(class="form-check-label") }}
                            </div>
                            <small class="text-muted">Auto-create vouchers on production completion</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.auto_expense_voucher(class="form-check-input") }}
                                {{ form.auto_expense_voucher.label(class="form-check-label") }}
                            </div>
                            <small class="text-muted">Auto-create vouchers for factory expenses</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.auto_salary_voucher(class="form-check-input") }}
                                {{ form.auto_salary_voucher.label(class="form-check-label") }}
                            </div>
                            <small class="text-muted">Auto-create vouchers for salary payments</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Calculation Settings -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-calculator"></i> Calculation Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            {{ form.amount_rounding_places.label(class="form-label") }}
                            {{ form.amount_rounding_places(class="form-control") }}
                            {% if form.amount_rounding_places.errors %}
                                <div class="text-danger">
                                    {% for error in form.amount_rounding_places.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.rounding_method.label(class="form-label") }}
                            {{ form.rounding_method(class="form-select") }}
                            {% if form.rounding_method.errors %}
                                <div class="text-danger">
                                    {% for error in form.rounding_method.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.inventory_valuation_method.label(class="form-label") }}
                            {{ form.inventory_valuation_method(class="form-select") }}
                            {% if form.inventory_valuation_method.errors %}
                                <div class="text-danger">
                                    {% for error in form.inventory_valuation_method.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <small class="text-muted">Changing this will affect all inventory calculations</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <!-- Default Accounts -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-link"></i> Default Accounts</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            {{ form.default_cash_account_id.label(class="form-label") }}
                            {{ form.default_cash_account_id(class="form-select") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.default_bank_account_id.label(class="form-label") }}
                            {{ form.default_bank_account_id(class="form-select") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.default_purchase_account_id.label(class="form-label") }}
                            {{ form.default_purchase_account_id(class="form-select") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.default_sales_account_id.label(class="form-label") }}
                            {{ form.default_sales_account_id(class="form-select") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.default_inventory_account_id.label(class="form-label") }}
                            {{ form.default_inventory_account_id(class="form-select") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.default_cogs_account_id.label(class="form-label") }}
                            {{ form.default_cogs_account_id(class="form-select") }}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- GST & Payment Settings -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-percentage"></i> GST & Payment Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            {{ form.gst_number.label(class="form-label") }}
                            {{ form.gst_number(class="form-control") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.place_of_business.label(class="form-label") }}
                            {{ form.place_of_business(class="form-control") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.default_gst_rate.label(class="form-label") }}
                            <div class="input-group">
                                {{ form.default_gst_rate(class="form-control") }}
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.enable_upi_payments(class="form-check-input") }}
                                {{ form.enable_upi_payments.label(class="form-check-label") }}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.enable_credit_payments(class="form-check-input") }}
                                {{ form.enable_credit_payments.label(class="form-check-label") }}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            {{ form.default_credit_days.label(class="form-label") }}
                            <div class="input-group">
                                {{ form.default_credit_days(class="form-control") }}
                                <span class="input-group-text">days</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Save Button -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center">
                        {{ form.submit(class="btn btn-primary btn-lg") }}
                        <a href="{{ url_for('accounting_settings.dashboard') }}" class="btn btn-secondary btn-lg ms-2">Cancel</a>
                        
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i>
                                Changes to automation settings will affect all future transactions.
                                Inventory valuation changes will trigger a system-wide recalculation.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // Show warning when changing inventory valuation method
    $('#inventory_valuation_method').change(function() {
        var newMethod = $(this).val();
        if (newMethod !== '{{ settings.inventory_valuation_method }}') {
            alert('Changing inventory valuation method will trigger recalculation of all inventory values. This may take some time.');
        }
    });
    
    // Auto-save warning
    $('form').on('submit', function() {
        return confirm('Are you sure you want to save these settings? This will affect the entire accounting system.');
    });
});
</script>
{% endblock %}